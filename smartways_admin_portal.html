<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smartways Admin Portal - Delivery Instructions Management</title>
    
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Supabase Configuration -->
    <script>
        // Replace with your actual Supabase credentials
        const SUPABASE_URL = 'https://umlkgeczmehclbmmpuuv.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVtbGtnZWN6bWVoY2xibW1wdXV2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0NTUxOTQsImV4cCI6MjA3NDAzMTE5NH0.GrJMY3LL9_QJMmgcTFHY6ezqxgAPPplYLulzUVX4aBs';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        console.log('Supabase client initialized:', supabase);
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            overflow-x: hidden;
        }
        
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transition: transform 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }
        
        .sidebar.collapsed {
            transform: translateX(-280px);
        }
        
        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .sidebar-header h1 {
            font-size: 22px;
            margin-bottom: 5px;
        }
        
        .sidebar-header p {
            opacity: 0.8;
            font-size: 14px;
        }
        
        .sidebar-menu {
            padding: 20px 0;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        
        .menu-item:hover {
            background: rgba(255,255,255,0.1);
            border-left-color: white;
        }
        
        .menu-item.active {
            background: rgba(255,255,255,0.15);
            border-left-color: #ffd700;
        }
        
        .menu-item i {
            font-size: 18px;
            margin-right: 15px;
            width: 20px;
        }
        
        .main-content {
            margin-left: 280px;
            min-height: 100vh;
            transition: margin-left 0.3s ease;
        }
        
        .main-content.expanded {
            margin-left: 0;
        }
        
        .top-bar {
            background: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .top-bar-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .menu-toggle {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
        }
        
        .search-bar {
            position: relative;
        }
        
        .search-bar input {
            padding: 10px 40px 10px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            width: 300px;
            font-size: 14px;
        }
        
        .search-bar input:focus {
            outline: none;
            border-color: #2196F3;
        }
        
        .search-bar i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }
        
        .top-bar-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .notifications {
            position: relative;
            cursor: pointer;
        }
        
        .notifications i {
            font-size: 20px;
            color: #666;
        }
        
        .notifications .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f44336;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 25px;
            transition: background 0.3s ease;
        }
        
        .user-profile:hover {
            background: #f8f9fa;
        }
        
        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .content-area {
            padding: 30px;
        }
        
        .page-header {
            margin-bottom: 30px;
        }
        
        .page-title {
            font-size: 28px;
            color: #333;
            margin-bottom: 10px;
        }
        
        .page-subtitle {
            color: #666;
            font-size: 16px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .stat-icon.blue { background: linear-gradient(135deg, #2196F3, #21CBF3); color: white; }
        .stat-icon.green { background: linear-gradient(135deg, #4CAF50, #8BC34A); color: white; }
        .stat-icon.orange { background: linear-gradient(135deg, #FF9800, #FFC107); color: white; }
        .stat-icon.purple { background: linear-gradient(135deg, #9C27B0, #E91E63); color: white; }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .card-header {
            padding: 25px 30px 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }
        
        .card-body {
            padding: 25px 30px;
        }
        
        .submissions-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .submissions-table th {
            text-align: left;
            padding: 15px 10px;
            font-weight: 600;
            color: #666;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .submissions-table td {
            padding: 15px 10px;
            border-bottom: 1px solid #f8f9fa;
            vertical-align: middle;
        }
        
        .submissions-table tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-pending { background: #fff3e0; color: #ef6c00; }
        .status-approved { background: #e8f5e8; color: #2e7d32; }
        .status-rejected { background: #ffebee; color: #c62828; }
        .status-review { background: #e3f2fd; color: #1565c0; }
        
        .priority-badge {
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .priority-high { background: #ffebee; color: #c62828; }
        .priority-medium { background: #fff3e0; color: #ef6c00; }
        .priority-low { background: #e8f5e8; color: #2e7d32; }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            margin-right: 5px;
            transition: all 0.3s ease;
        }
        
        .action-btn.view { background: #e3f2fd; color: #1565c0; }
        .action-btn.edit { background: #fff3e0; color: #ef6c00; }
        .action-btn.delete { background: #ffebee; color: #c62828; }
        
        .action-btn:hover {
            transform: translateY(-1px);
            opacity: 0.8;
        }
        
        .media-preview {
            display: flex;
            gap: 5px;
        }
        
        .media-thumb {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .media-thumb:hover {
            transform: scale(1.1);
        }
        
        .activity-item {
            display: flex;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .activity-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .activity-time {
            color: #999;
            font-size: 12px;
        }
        
        .filter-bar {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-label {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
        }
        
        .filter-select {
            padding: 8px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            min-width: 120px;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #2196F3;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #2196F3, #21CBF3);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #FF9800, #FFC107);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f44336, #e53935);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        .modal-header {
            padding: 25px 30px 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
        }
        
        .modal-close {
            position: absolute;
            top: 20px;
            right: 25px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .modal-body {
            padding: 25px 30px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-label {
            font-weight: 600;
            color: #333;
        }
        
        .form-input {
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #2196F3;
        }
        
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .media-item {
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        
        .media-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .media-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }
        
        .media-item-info {
            padding: 10px;
            background: #f8f9fa;
        }
        
        .media-item-name {
            font-size: 12px;
            color: #333;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .media-item-type {
            font-size: 11px;
            color: #666;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 25px;
        }
        
        .pagination-btn {
            padding: 8px 12px;
            border: 2px solid #e1e5e9;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pagination-btn:hover {
            border-color: #2196F3;
            background: #f8fffe;
        }
        
        .pagination-btn.active {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
        }
        
        .page-content {
            display: none;
        }
        
        .page-content.active {
            display: block;
        }
        
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-280px);
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .top-bar {
                padding: 15px 20px;
            }
            
            .search-bar input {
                width: 200px;
            }
            
            .content-area {
                padding: 20px;
            }
            
            .filter-bar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .submissions-table {
                font-size: 12px;
            }
            
            .submissions-table th,
            .submissions-table td {
                padding: 8px 5px;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1>Smartways</h1>
            <p>Admin Portal</p>
        </div>
        <nav class="sidebar-menu">
            <div class="menu-item active" data-page="dashboard">
                <i>üìä</i>
                <span>Dashboard</span>
            </div>
            <div class="menu-item" data-page="submissions">
                <i>üìù</i>
                <span>Submissions</span>
            </div>
            <div class="menu-item" data-page="clients">
                <i>üè¢</i>
                <span>Clients & Branches</span>
            </div>
            <div class="menu-item" data-page="drivers">
                <i>üöõ</i>
                <span>Drivers</span>
            </div>
            <div class="menu-item" data-page="media">
                <i>üì∏</i>
                <span>Media Library</span>
            </div>
            <div class="menu-item" data-page="analytics">
                <i>üìà</i>
                <span>Analytics</span>
            </div>
            <div class="menu-item" data-page="settings">
                <i>‚öôÔ∏è</i>
                <span>Settings</span>
            </div>
        </nav>
    </div>
    
    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="top-bar-left">
                <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <div class="search-bar">
                    <input type="text" placeholder="Search submissions, drivers, clients...">
                    <i>üîç</i>
                </div>
            </div>
            <div class="top-bar-right">
                <div class="notifications">
                    <i>üîî</i>
                    <span class="badge">3</span>
                </div>
                <div class="user-profile">
                    <div class="user-avatar">AD</div>
                    <div>
                        <div style="font-weight: 600; font-size: 14px;">Admin User</div>
                        <div style="font-size: 12px; color: #666;">System Administrator</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Content Area -->
        <div class="content-area">
            <!-- Dashboard Page -->
            <div class="page-content active" id="dashboard">
                <div class="page-header">
                    <h1 class="page-title">Dashboard Overview</h1>
                    <p class="page-subtitle">Welcome back! Here's what's happening with your delivery instructions system.</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon blue">üìù</div>
                        <div class="stat-value">247</div>
                        <div class="stat-label">Total Submissions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green">‚úÖ</div>
                        <div class="stat-value">189</div>
                        <div class="stat-label">Approved Instructions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon orange">‚è≥</div>
                        <div class="stat-value">34</div>
                        <div class="stat-label">Pending Review</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon purple">üë•</div>
                        <div class="stat-value">67</div>
                        <div class="stat-label">Active Drivers</div>
                    </div>
                </div>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Recent Submissions</h3>
                            <button class="btn btn-primary" onclick="showPage('submissions')">View All</button>
                        </div>
                        <div class="card-body">
                            <table class="submissions-table">
                                <thead>
                                    <tr>
                                        <th>Driver</th>
                                        <th>Client</th>
                                        <th>Status</th>
                                        <th>Media</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Mike Johnson</td>
                                        <td>Woolworths CBD</td>
                                        <td><span class="status-badge status-pending">Pending</span></td>
                                        <td>
                                            <div class="media-preview">
                                                <div class="media-thumb">üì∑</div>
                                                <div class="media-thumb">üé•</div>
                                                <div class="media-thumb">üìÑ</div>
                                            </div>
                                        </td>
                                        <td>
                                            <button class="action-btn view" onclick="viewSubmission(1)">View</button>
                                            <button class="action-btn edit">Edit</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Sarah Chen</td>
                                        <td>Coles Town Hall</td>
                                        <td><span class="status-badge status-approved">Approved</span></td>
                                        <td>
                                            <div class="media-preview">
                                                <div class="media-thumb">üì∑</div>
                                                <div class="media-thumb">üì∑</div>
                                            </div>
                                        </td>
                                        <td>
                                            <button class="action-btn view" onclick="viewSubmission(2)">View</button>
                                            <button class="action-btn edit">Edit</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>David Wilson</td>
                                        <td>IGA Surry Hills</td>
                                        <td><span class="status-badge status-review">Review</span></td>
                                        <td>
                                            <div class="media-preview">
                                                <div class="media-thumb">üé•</div>
                                                <div class="media-thumb">üìÑ</div>
                                            </div>
                                        </td>
                                        <td>
                                            <button class="action-btn view" onclick="viewSubmission(3)">View</button>
                                            <button class="action-btn edit">Edit</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Recent Activity</h3>
                        </div>
                        <div class="card-body">
                            <div class="activity-item">
                                <div class="activity-icon" style="background: #e3f2fd; color: #1565c0;">üìù</div>
                                <div class="activity-content">
                                    <div class="activity-title">New submission from Mike Johnson</div>
                                    <div class="activity-description">Woolworths CBD delivery instructions with 3 media files</div>
                                    <div class="activity-time">2 minutes ago</div>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon" style="background: #e8f5e8; color: #2e7d32;">‚úÖ</div>
                                <div class="activity-content">
                                    <div class="activity-title">Instructions approved</div>
                                    <div class="activity-description">Sarah Chen's Coles Town Hall instructions approved</div>
                                    <div class="activity-time">15 minutes ago</div>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon" style="background: #fff3e0; color: #ef6c00;">üë•</div>
                                <div class="activity-content">
                                    <div class="activity-title">New driver registered</div>
                                    <div class="activity-description">Alex Thompson joined the system</div>
                                    <div class="activity-time">1 hour ago</div>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon" style="background: #ffebee; color: #c62828;">üìã</div>
                                <div class="activity-content">
                                    <div class="activity-title">Instructions updated</div>
                                    <div class="activity-description">Metro Martin Place delivery procedures revised</div>
                                    <div class="activity-time">3 hours ago</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Submissions Page -->
            <div class="page-content" id="submissions">
                <div class="page-header">
                    <h1 class="page-title">Driver Submissions</h1>
                    <p class="page-subtitle">Review and manage all delivery instruction submissions.</p>
                </div>
                
                <div class="filter-bar">
                    <div class="filter-group">
                        <div class="filter-label">Status</div>
                        <select class="filter-select">
                            <option value="">All Statuses</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                            <option value="review">Under Review</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <div class="filter-label">Client</div>
                        <select class="filter-select">
                            <option value="">All Clients</option>
                            <option value="woolworths">Woolworths</option>
                            <option value="coles">Coles</option>
                            <option value="iga">IGA</option>
                            <option value="metro">Metro</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <div class="filter-label">Date Range</div>
                        <select class="filter-select">
                            <option value="">All Time</option>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <div class="filter-label">Priority</div>
                        <select class="filter-select">
                            <option value="">All Priorities</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">All Submissions</h3>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-success">Bulk Approve</button>
                            <button class="btn btn-warning" onclick="showExportModal()">üìä Export Data</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <table class="submissions-table">
                            <thead>
                                <tr>
                                    <th><input type="checkbox"> ID</th>
                                    <th>Driver</th>
                                    <th>Client/Branch</th>
                                    <th>Submitted</th>
                                    <th>Status</th>
                                    <th>Priority</th>
                                    <th>Media</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="submissionsTableBody">
                                <!-- Dynamic content will be loaded here -->
                            </tbody>
                        </table>
                        
                        <div class="pagination">
                            <button class="pagination-btn">‚Äπ‚Äπ First</button>
                            <button class="pagination-btn">‚Äπ Previous</button>
                            <button class="pagination-btn active">1</button>
                            <button class="pagination-btn">2</button>
                            <button class="pagination-btn">3</button>
                            <button class="pagination-btn">Next ‚Ä∫</button>
                            <button class="pagination-btn">Last ‚Ä∫‚Ä∫</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Other pages placeholder -->
            <div class="page-content" id="clients">
                <div class="page-header">
                    <h1 class="page-title">Clients & Branches</h1>
                    <p class="page-subtitle">Manage master clients and their delivery locations.</p>
                </div>
                <div class="card">
                    <div class="card-body">
                        <p>Client and branch management interface coming soon...</p>
                    </div>
                </div>
            </div>
            
            <div class="page-content" id="drivers">
                <div class="page-header">
                    <h1 class="page-title">Driver Management</h1>
                    <p class="page-subtitle">Oversee driver accounts and performance metrics.</p>
                </div>
                <div class="card">
                    <div class="card-body">
                        <p>Driver management interface coming soon...</p>
                    </div>
                </div>
            </div>
            
            <div class="page-content" id="media">
                <div class="page-header">
                    <h1 class="page-title">Media Library</h1>
                    <p class="page-subtitle">Browse and manage all uploaded photos, videos, and documents.</p>
                </div>
                <div class="card">
                    <div class="card-body">
                        <p>Media library interface coming soon...</p>
                    </div>
                </div>
            </div>
            
            <div class="page-content" id="analytics">
                <div class="page-header">
                    <h1 class="page-title">Analytics & Reports</h1>
                    <p class="page-subtitle">Gain insights into system usage and performance metrics.</p>
                </div>
                <div class="card">
                    <div class="card-body">
                        <p>Analytics dashboard coming soon...</p>
                    </div>
                </div>
            </div>
            
            <div class="page-content" id="settings">
                <div class="page-header">
                    <h1 class="page-title">System Settings</h1>
                    <p class="page-subtitle">Configure system preferences and user permissions.</p>
                </div>
                <div class="card">
                    <div class="card-body">
                        <p>Settings interface coming soon...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Export Data Modal -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üìä Export Submission Data</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <div class="form-label">Export Format</div>
                    <select class="form-input" id="exportFormat">
                        <option value="csv">CSV (Comma Separated Values)</option>
                        <option value="excel">Excel Spreadsheet (.xlsx)</option>
                        <option value="json">JSON Data Export</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <div class="form-label">Data Range</div>
                    <select class="form-input" id="exportDateRange">
                        <option value="all">All Time</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="quarter">This Quarter</option>
                        <option value="year">This Year</option>
                        <option value="custom">Custom Date Range</option>
                    </select>
                </div>
                
                <div class="form-grid" id="customDateRange" style="display: none;">
                    <div class="form-group">
                        <div class="form-label">Start Date</div>
                        <input type="date" class="form-input" id="exportStartDate">
                    </div>
                    <div class="form-group">
                        <div class="form-label">End Date</div>
                        <input type="date" class="form-input" id="exportEndDate">
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="form-label">Filter by Status</div>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 10px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" checked id="exportPending"> 
                            <span class="status-badge status-pending">Pending</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" checked id="exportApproved"> 
                            <span class="status-badge status-approved">Approved</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" checked id="exportRejected"> 
                            <span class="status-badge status-rejected">Rejected</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" checked id="exportReview"> 
                            <span class="status-badge status-review">Review</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="form-label">Filter by Client</div>
                    <select class="form-input" id="exportClient">
                        <option value="all">All Clients</option>
                        <option value="woolworths">Woolworths Group</option>
                        <option value="coles">Coles Supermarkets</option>
                        <option value="iga">IGA Stores</option>
                        <option value="metro">Metro Food Markets</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <div class="form-label">Include Fields</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 10px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" checked id="includeBasicInfo"> Basic Information
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" checked id="includeInstructions"> Delivery Instructions
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" checked id="includeChallenges"> Challenges/Issues
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" checked id="includeMediaInfo"> Media Information
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="includeDriverDetails"> Driver Details
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="includeTimestamps"> Detailed Timestamps
                        </label>
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;">
                    <h4 style="margin: 0 0 10px 0; color: #333;">Export Preview</h4>
                    <div id="exportPreview" style="font-size: 14px; color: #666;">
                        Select your options to see export preview...
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px; padding-top: 20px; border-top: 1px solid #f0f0f0;">
                    <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="generateExport()">üì• Generate Export</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Submission Detail Modal -->
    <div class="modal" id="submissionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Submission Details</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="submissionModalBody">
                <!-- Dynamic content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Sample data - REPLACE THIS SECTION WITH SUPABASE CALLS
        let submissionsData = [];
        
        // Initialize Supabase data loading
        async function loadSubmissionsFromDB() {
            try {
                showNotification('Loading submissions from database...', 'info');
                
                // First, get submissions
                const { data: submissions, error: submissionsError } = await supabase
                    .from('submissions')
                    .select('*')
                    .order('submitted_at', { ascending: false });

                if (submissionsError) {
                    console.error('Submissions query error:', submissionsError);
                    throw submissionsError;
                }

                console.log('Raw submissions from database:', submissions);

                if (!submissions || submissions.length === 0) {
                    console.log('No submissions found in database');
                    submissionsData = [];
                    loadSubmissionsTable();
                    showNotification('No submissions found in database', 'info');
                    return;
                }

                // Get related data separately with individual error handling
                let driversData = [];
                let clientsData = [];
                let branchesData = [];
                let mediaData = [];

                try {
                    const driversResult = await supabase.from('drivers').select('*');
                    driversData = driversResult.data || [];
                    if (driversResult.error) console.error('Drivers query error:', driversResult.error);
                } catch (e) {
                    console.error('Failed to load drivers:', e);
                }

                try {
                    const clientsResult = await supabase.from('clients').select('*');
                    clientsData = clientsResult.data || [];
                    if (clientsResult.error) console.error('Clients query error:', clientsResult.error);
                } catch (e) {
                    console.error('Failed to load clients:', e);
                }

                try {
                    const branchesResult = await supabase.from('branches').select('*');
                    branchesData = branchesResult.data || [];
                    if (branchesResult.error) console.error('Branches query error:', branchesResult.error);
                } catch (e) {
                    console.error('Failed to load branches:', e);
                }

                try {
                    const mediaResult = await supabase.from('media_files').select('*');
                    mediaData = mediaResult.data || [];
                    if (mediaResult.error) console.error('Media query error:', mediaResult.error);
                } catch (e) {
                    console.error('Failed to load media files:', e);
                }

                console.log('Loaded related data:', {
                    drivers: driversData.length,
                    clients: clientsData.length,
                    branches: branchesData.length,
                    media: mediaData.length
                });

                // Create lookup maps safely
                const driversMap = new Map();
                driversData.forEach(d => d && d.id && driversMap.set(d.id, d));
                
                const clientsMap = new Map();
                clientsData.forEach(c => c && c.id && clientsMap.set(c.id, c));
                
                const branchesMap = new Map();
                branchesData.forEach(b => b && b.id && branchesMap.set(b.id, b));
                
                // Group media files by submission
                const mediaBySubmission = {};
                mediaData.forEach(media => {
                    if (media && media.submission_id) {
                        if (!mediaBySubmission[media.submission_id]) {
                            mediaBySubmission[media.submission_id] = [];
                        }
                        mediaBySubmission[media.submission_id].push(media);
                    }
                });

                // Map submissions with related data
                submissionsData = submissions.map(item => {
                    if (!item || !item.id) {
                        console.warn('Invalid submission item:', item);
                        return null;
                    }

                    const driver = driversMap.get(item.driver_id) || {};
                    const client = clientsMap.get(item.client_id) || {};
                    const branch = branchesMap.get(item.branch_id) || {};
                    const mediaFiles = mediaBySubmission[item.id] || [];

                    return {
                        id: item.id,
                        driver: driver.full_name || 'Unknown Driver',
                        driverUsername: driver.username || '',
                        driverRegion: driver.region || '',
                        client: `${client.name || 'Unknown'} - ${branch.name || 'Unknown'}`,
                        clientCode: client.client_code || '',
                        branch: branch.name || '',
                        submitted: new Date(item.submitted_at).toLocaleString(),
                        lastModified: new Date(item.updated_at).toLocaleString(),
                        status: item.status || 'pending',
                        priority: item.priority || 'medium',
                        mediaCount: mediaFiles.length,
                        mediaTypes: [...new Set(mediaFiles.map(f => f.file_type))].join(', ') || 'None',
                        mediaSize: formatFileSize(mediaFiles.reduce((sum, f) => sum + (f.file_size || 0), 0)),
                        instructions: item.instructions || '',
                        instructionType: item.instruction_types || '',
                        frequency: item.delivery_frequency || '',
                        challenges: item.challenges || '',
                        reviewedBy: item.reviewed_by || null,
                        reviewNotes: item.review_notes || null,
                        media_files: mediaFiles
                    };
                }).filter(Boolean); // Remove any null items

                console.log('Processed submissions data:', submissionsData);

                loadSubmissionsTable();
                showNotification(`Loaded ${submissionsData.length} submissions successfully`, 'success');
                
            } catch (error) {
                console.error('Error loading submissions:', error);
                console.error('Error details:', {
                    message: error.message,
                    details: error.details,
                    hint: error.hint,
                    code: error.code
                });
                showNotification(`Database error: ${error.message}. Using sample data.`, 'error');
                
                // Fallback to sample data if database fails
                loadSampleData();
            }
        }
        
        // Fallback sample data function
        function loadSampleData() {
            submissionsData = [
                {
                    id: 1,
                    driver: 'Mike Johnson',
                    driverUsername: 'mjohnson',
                    driverRegion: 'Sydney',
                    client: 'Woolworths CBD',
                    clientCode: 'WW-CBD-001',
                    branch: 'CBD Store',
                    submitted: '2025-09-21 09:30',
                    lastModified: '2025-09-21 09:35',
                    status: 'pending',
                    priority: 'high',
                    media: ['üì∑', 'üé•', 'üìÑ'],
                    mediaCount: 3,
                    mediaTypes: 'Photo, Video, Document',
                    mediaSize: '11.3 MB',
                    instructions: 'Use keypad code 1234# at main entrance. Loading dock is on level B2, use freight elevator only.',
                    instructionType: 'Access, Delivery',
                    frequency: 'Daily',
                    challenges: 'Heavy traffic during peak hours, parking can be difficult.',
                    reviewedBy: null,
                    reviewNotes: null
                },
                {
                    id: 2,
                    driver: 'Sarah Chen',
                    driverUsername: 'schen',
                    driverRegion: 'Sydney',
                    client: 'Coles Town Hall',
                    clientCode: 'CL-TH-002',
                    branch: 'Town Hall Store',
                    submitted: '2025-09-21 08:15',
                    lastModified: '2025-09-21 10:20',
                    status: 'approved',
                    priority: 'medium',
                    media: ['üì∑', 'üì∑'],
                    mediaCount: 2,
                    mediaTypes: 'Photo',
                    mediaSize: '4.2 MB',
                    instructions: 'Delivery entrance via George Street side. Contact security desk first.',
                    instructionType: 'Access, Contact',
                    frequency: 'Weekly',
                    challenges: 'Security protocol must be followed strictly.',
                    reviewedBy: 'Admin User',
                    reviewNotes: 'Clear instructions, approved for implementation.'
                },
                {
                    id: 3,
                    driver: 'David Wilson',
                    driverUsername: 'dwilson',
                    driverRegion: 'Melbourne',
                    client: 'IGA Surry Hills',
                    clientCode: 'IGA-SH-003',
                    branch: 'Surry Hills Store',
                    submitted: '2025-09-21 07:45',
                    lastModified: '2025-09-21 09:15',
                    status: 'review',
                    priority: 'low',
                    media: ['üé•', 'üìÑ'],
                    mediaCount: 2,
                    mediaTypes: 'Video, Document',
                    mediaSize: '9.1 MB',
                    instructions: 'Small loading bay, reverse parking required. Call ahead 30 minutes before arrival.',
                    instructionType: 'Delivery, Timing',
                    frequency: 'Bi-weekly',
                    challenges: 'Limited space for large trucks.',
                    reviewedBy: null,
                    reviewNotes: null
                },
                {
                    id: 4,
                    driver: 'Emma Davis',
                    driverUsername: 'edavis',
                    driverRegion: 'Brisbane',
                    client: 'Metro Martin Place',
                    clientCode: 'MT-MP-004',
                    branch: 'Martin Place Store',
                    submitted: '2025-09-20 16:20',
                    lastModified: '2025-09-20 16:45',
                    status: 'approved',
                    priority: 'medium',
                    media: ['üì∑'],
                    mediaCount: 1,
                    mediaTypes: 'Photo',
                    mediaSize: '2.8 MB',
                    instructions: 'Underground delivery via ramp. Height restriction 2.5m.',
                    instructionType: 'Delivery, Special Handling',
                    frequency: 'Monthly',
                    challenges: 'Height restrictions, tight corners in underground access.',
                    reviewedBy: 'Admin User',
                    reviewNotes: 'Important height restriction noted, approved.'
                },
                {
                    id: 5,
                    driver: 'Tom Brown',
                    driverUsername: 'tbrown',
                    driverRegion: 'Perth',
                    client: 'Woolworths Bondi',
                    clientCode: 'WW-BD-005',
                    branch: 'Bondi Junction Store',
                    submitted: '2025-09-20 14:10',
                    lastModified: '2025-09-20 15:30',
                    status: 'rejected',
                    priority: 'low',
                    media: ['üìÑ'],
                    mediaCount: 1,
                    mediaTypes: 'Document',
                    mediaSize: '0.2 MB',
                    instructions: 'Standard delivery to rear dock.',
                    instructionType: 'Delivery',
                    frequency: 'Weekly',
                    challenges: 'None noted.',
                    reviewedBy: 'Admin User',
                    reviewNotes: 'Insufficient detail provided, requires more specific instructions.'
                }
            ];
            
            loadSubmissionsTable();
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Try to load from Supabase, fallback to sample data
            if (typeof supabase !== 'undefined') {
                loadSubmissionsFromDB();
            } else {
                console.warn('Supabase not available, using sample data');
                loadSampleData();
            }
        });
        
        // Sidebar toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            
            if (window.innerWidth <= 1024) {
                sidebar.classList.toggle('open');
            } else {
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('expanded');
            }
        }
        
        // Page navigation
        function showPage(pageId) {
            // Hide all page contents
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update sidebar menu
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.querySelector(`[data-page="${pageId}"]`).classList.add('active');
        }
        
        // Menu item click handlers
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', function() {
                const pageId = this.dataset.page;
                showPage(pageId);
            });
        });
        
        // Load submissions table
        function loadSubmissionsTable() {
            const tbody = document.getElementById('submissionsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            submissionsData.forEach(submission => {
                const row = document.createElement('tr');
                
                const statusClass = `status-${submission.status}`;
                const priorityClass = `priority-${submission.priority}`;
                
                const mediaIcons = submission.media.map(icon => 
                    `<div class="media-thumb">${icon}</div>`
                ).join('');
                
                row.innerHTML = `
                    <td><input type="checkbox"> #${submission.id}</td>
                    <td>${submission.driver}</td>
                    <td>${submission.client}</td>
                    <td>${submission.submitted}</td>
                    <td><span class="status-badge ${statusClass}">${submission.status}</span></td>
                    <td><span class="priority-badge ${priorityClass}">${submission.priority}</span></td>
                    <td><div class="media-preview">${mediaIcons}</div></td>
                    <td>
                        <button class="action-btn view" onclick="viewSubmission(${submission.id})">View</button>
                        <button class="action-btn edit" onclick="editSubmission(${submission.id})">Edit</button>
                        <button class="action-btn delete" onclick="deleteSubmission(${submission.id})">Delete</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // View submission details
        function viewSubmission(id) {
            const submission = submissionsData.find(s => s.id === id);
            if (!submission) return;
            
            const modalBody = document.getElementById('submissionModalBody');
            
            modalBody.innerHTML = `
                <div class="form-grid">
                    <div class="form-group">
                        <div class="form-label">Submission ID</div>
                        <div class="form-input" style="background: #f8f9fa;">#${submission.id}</div>
                    </div>
                    <div class="form-group">
                        <div class="form-label">Driver</div>
                        <div class="form-input" style="background: #f8f9fa;">${submission.driver}</div>
                    </div>
                    <div class="form-group">
                        <div class="form-label">Client/Branch</div>
                        <div class="form-input" style="background: #f8f9fa;">${submission.client}</div>
                    </div>
                    <div class="form-group">
                        <div class="form-label">Submitted</div>
                        <div class="form-input" style="background: #f8f9fa;">${submission.submitted}</div>
                    </div>
                    <div class="form-group">
                        <div class="form-label">Status</div>
                        <select class="form-input">
                            <option value="pending" ${submission.status === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="approved" ${submission.status === 'approved' ? 'selected' : ''}>Approved</option>
                            <option value="rejected" ${submission.status === 'rejected' ? 'selected' : ''}>Rejected</option>
                            <option value="review" ${submission.status === 'review' ? 'selected' : ''}>Under Review</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <div class="form-label">Priority</div>
                        <select class="form-input">
                            <option value="low" ${submission.priority === 'low' ? 'selected' : ''}>Low</option>
                            <option value="medium" ${submission.priority === 'medium' ? 'selected' : ''}>Medium</option>
                            <option value="high" ${submission.priority === 'high' ? 'selected' : ''}>High</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="form-label">Delivery Instructions</div>
                    <textarea class="form-input" rows="4" readonly style="background: #f8f9fa;">${submission.instructions}</textarea>
                </div>
                
                <div class="form-group">
                    <div class="form-label">Challenges/Issues</div>
                    <textarea class="form-input" rows="3" readonly style="background: #f8f9fa;">${submission.challenges}</textarea>
                </div>
                
                <div class="form-group">
                    <div class="form-label">Attached Media</div>
                    <div class="media-grid">
                        <div class="media-item">
                            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEyMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkVudHJhbmNlIFBob3RvPC90ZXh0Pjwvc3ZnPg==" alt="Photo">
                            <div class="media-item-info">
                                <div class="media-item-name">entrance_keypad.jpg</div>
                                <div class="media-item-type">Photo ‚Ä¢ 2.1 MB</div>
                            </div>
                        </div>
                        <div class="media-item">
                            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEyMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMzMzIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkFjY2VzcyBWaWRlbzwvdGV4dD48dGV4dCB4PSI1MCUiIHk9IjgwJSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjMwIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7ilrA8L3RleHQ+PC9zdmc+" alt="Video">
                            <div class="media-item-info">
                                <div class="media-item-name">access_procedure.mp4</div>
                                <div class="media-item-type">Video ‚Ä¢ 45s ‚Ä¢ 8.7 MB</div>
                            </div>
                        </div>
                        <div class="media-item">
                            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjEyMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjBmMGYwIi8+PHRleHQgeD0iNTAlIiB5PSI0MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIzMCIgZmlsbD0iIzY2NiIgdGV4dC1hbmNob3I9Im1pZGRsZSI+8J+ThDwvdGV4dD48dGV4dCB4PSI1MCUiIHk9IjcwJSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBmaWxsPSIjNjY2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5Db250YWN0IExpc3Q8L3RleHQ+PC9zdmc+" alt="Document">
                            <div class="media-item-info">
                                <div class="media-item-name">contact_list.pdf</div>
                                <div class="media-item-type">Document ‚Ä¢ 156 KB</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px; padding-top: 20px; border-top: 1px solid #f0f0f0;">
                    <button class="btn btn-danger">Reject</button>
                    <button class="btn btn-warning">Request Changes</button>
                    <button class="btn btn-success">Approve</button>
                </div>
            `;
            
            document.getElementById('submissionModal').classList.add('active');
        }
        
        // Edit submission
        function editSubmission(id) {
            console.log('Edit submission:', id);
            // Implement edit functionality
        }
        
        // Delete submission
        function deleteSubmission(id) {
            if (confirm('Are you sure you want to delete this submission?')) {
                console.log('Delete submission:', id);
                // Implement delete functionality
            }
        }
        
        // Close modal
        function closeModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
        }
        
        // Close modal on background click
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                closeModal();
            }
        });
        
        // Responsive sidebar
        window.addEventListener('resize', function() {
            if (window.innerWidth > 1024) {
                document.getElementById('sidebar').classList.remove('open');
            }
        });
        
        // Export functionality
        function showExportModal() {
            document.getElementById('exportModal').classList.add('active');
            updateExportPreview();
        }
        
        // Handle date range selection
        document.getElementById('exportDateRange').addEventListener('change', function() {
            const customRange = document.getElementById('customDateRange');
            if (this.value === 'custom') {
                customRange.style.display = 'grid';
            } else {
                customRange.style.display = 'none';
            }
            updateExportPreview();
        });
        
        // Update export preview when options change
        document.addEventListener('change', function(e) {
            if (e.target.closest('#exportModal')) {
                updateExportPreview();
            }
        });
        
        function updateExportPreview() {
            const filteredData = getFilteredExportData();
            const format = document.getElementById('exportFormat').value;
            
            let preview = `
                <strong>Records to export:</strong> ${filteredData.length} submissions<br>
                <strong>Format:</strong> ${format.toUpperCase()}<br>
                <strong>Estimated file size:</strong> ${getEstimatedFileSize(filteredData, format)}<br>
            `;
            
            if (filteredData.length > 0) {
                const statusBreakdown = getStatusBreakdown(filteredData);
                preview += `<strong>Status breakdown:</strong> ${statusBreakdown}`;
            }
            
            document.getElementById('exportPreview').innerHTML = preview;
        }
        
        function getFilteredExportData() {
            let filtered = [...submissionsData];
            
            // Filter by status
            const statuses = [];
            if (document.getElementById('exportPending').checked) statuses.push('pending');
            if (document.getElementById('exportApproved').checked) statuses.push('approved');
            if (document.getElementById('exportRejected').checked) statuses.push('rejected');
            if (document.getElementById('exportReview').checked) statuses.push('review');
            
            filtered = filtered.filter(item => statuses.includes(item.status));
            
            // Filter by client
            const client = document.getElementById('exportClient').value;
            if (client !== 'all') {
                filtered = filtered.filter(item => item.client.toLowerCase().includes(client));
            }
            
            // Filter by date range
            const dateRange = document.getElementById('exportDateRange').value;
            if (dateRange !== 'all') {
                filtered = filterByDateRange(filtered, dateRange);
            }
            
            return filtered;
        }
        
        function filterByDateRange(data, range) {
            const now = new Date();
            let startDate = new Date();
            
            switch (range) {
                case 'today':
                    startDate.setHours(0, 0, 0, 0);
                    break;
                case 'week':
                    startDate.setDate(now.getDate() - 7);
                    break;
                case 'month':
                    startDate.setMonth(now.getMonth() - 1);
                    break;
                case 'quarter':
                    startDate.setMonth(now.getMonth() - 3);
                    break;
                case 'year':
                    startDate.setFullYear(now.getFullYear() - 1);
                    break;
                case 'custom':
                    const startInput = document.getElementById('exportStartDate').value;
                    const endInput = document.getElementById('exportEndDate').value;
                    if (startInput) startDate = new Date(startInput);
                    if (endInput) now = new Date(endInput);
                    break;
            }
            
            return data.filter(item => {
                const itemDate = new Date(item.submitted);
                return itemDate >= startDate && itemDate <= now;
            });
        }
        
        function getStatusBreakdown(data) {
            const counts = {};
            data.forEach(item => {
                counts[item.status] = (counts[item.status] || 0) + 1;
            });
            
            return Object.entries(counts)
                .map(([status, count]) => `${status}: ${count}`)
                .join(', ');
        }
        
        function getEstimatedFileSize(data, format) {
            const baseSize = data.length * 0.5; // KB per record
            const multiplier = format === 'excel' ? 2 : format === 'json' ? 1.5 : 1;
            const size = baseSize * multiplier;
            
            if (size > 1024) {
                return `${(size / 1024).toFixed(1)} MB`;
            }
            return `${size.toFixed(1)} KB`;
        }
        
        function generateExport() {
            const filteredData = getFilteredExportData();
            const format = document.getElementById('exportFormat').value;
            
            if (filteredData.length === 0) {
                alert('No data to export with current filters.');
                return;
            }
            
            switch (format) {
                case 'csv':
                    exportCSV(filteredData);
                    break;
                case 'excel':
                    exportExcel(filteredData);
                    break;
                case 'json':
                    exportJSON(filteredData);
                    break;
            }
            
            closeModal();
        }
        
        function exportCSV(data) {
            const headers = getSelectedHeaders();
            const csvContent = [
                headers.join(','),
                ...data.map(row => headers.map(header => {
                    const value = getFieldValue(row, header);
                    // Escape commas and quotes in CSV
                    return `"${String(value).replace(/"/g, '""')}"`;
                }).join(','))
            ].join('\n');
            
            downloadFile(csvContent, 'smartways_submissions.csv', 'text/csv');
        }
        
        function exportExcel(data) {
            // For demo purposes, we'll export as CSV with .xlsx extension
            // In a real implementation, you'd use a library like SheetJS
            const headers = getSelectedHeaders();
            const csvContent = [
                headers.join('\t'), // Tab-separated for better Excel compatibility
                ...data.map(row => headers.map(header => getFieldValue(row, header)).join('\t'))
            ].join('\n');
            
            downloadFile(csvContent, 'smartways_submissions.xlsx', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
        }
        
        function exportJSON(data) {
            const headers = getSelectedHeaders();
            const jsonData = data.map(row => {
                const obj = {};
                headers.forEach(header => {
                    obj[header] = getFieldValue(row, header);
                });
                return obj;
            });
            
            const jsonContent = JSON.stringify({
                exportDate: new Date().toISOString(),
                totalRecords: jsonData.length,
                data: jsonData
            }, null, 2);
            
            downloadFile(jsonContent, 'smartways_submissions.json', 'application/json');
        }
        
        function getSelectedHeaders() {
            const headers = ['ID'];
            
            if (document.getElementById('includeBasicInfo').checked) {
                headers.push('Driver Name', 'Driver Username', 'Driver Region', 'Client', 'Client Code', 'Branch', 'Submitted Date', 'Status', 'Priority');
            }
            
            if (document.getElementById('includeInstructions').checked) {
                headers.push('Instructions', 'Instruction Type', 'Frequency');
            }
            
            if (document.getElementById('includeChallenges').checked) {
                headers.push('Challenges');
            }
            
            if (document.getElementById('includeMediaInfo').checked) {
                headers.push('Media Count', 'Media Types', 'Media Size');
            }
            
            if (document.getElementById('includeDriverDetails').checked) {
                headers.push('Driver Username', 'Driver Region');
            }
            
            if (document.getElementById('includeTimestamps').checked) {
                headers.push('Last Modified', 'Reviewed By', 'Review Notes');
            }
            
            return [...new Set(headers)]; // Remove duplicates
        }
        
        function getFieldValue(row, header) {
            const fieldMap = {
                'ID': row.id,
                'Driver Name': row.driver,
                'Driver Username': row.driverUsername,
                'Driver Region': row.driverRegion,
                'Client': row.client,
                'Client Code': row.clientCode,
                'Branch': row.branch,
                'Submitted Date': row.submitted,
                'Last Modified': row.lastModified,
                'Status': row.status,
                'Priority': row.priority,
                'Instructions': row.instructions,
                'Instruction Type': row.instructionType,
                'Frequency': row.frequency,
                'Challenges': row.challenges,
                'Media Count': row.mediaCount,
                'Media Types': row.mediaTypes,
                'Media Size': row.mediaSize,
                'Reviewed By': row.reviewedBy || 'Not reviewed',
                'Review Notes': row.reviewNotes || 'No notes'
            };
            
            return fieldMap[header] || '';
        }
        
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            // Show success message
            showNotification(`Export complete! ${filename} downloaded successfully.`, 'success');
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 3000;
                font-weight: 600;
                animation: slideIn 0.3s ease;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // Add CSS animations for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
